<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Marwan Sadek - Investment Portfolio</title>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            --bg-card: rgba(30, 41, 59, 0.7);
            --bg-input: rgba(51, 65, 85, 0.5);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: white;
            --text-secondary: #94a3b8;
        }
        [data-theme="light"] {
            --bg-primary: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 50%, #f1f5f9 100%);
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-input: rgba(241, 245, 249, 0.8);
            --border-color: rgba(0, 0, 0, 0.1);
            --text-primary: #0f172a;
            --text-secondary: #475569;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg-primary); background-attachment: fixed; color: var(--text-primary); min-height: 100vh; padding: 10px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .glass { background: var(--bg-card); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%); border: 1px solid var(--border-color); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        .header { padding: 20px; border-radius: 16px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header h1 { font-size: clamp(20px, 5vw, 34px); margin-bottom: 5px; font-weight: 700; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-info { color: var(--text-secondary); font-size: clamp(11px, 2.5vw, 14px); display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .live-clock { font-family: 'Courier New', monospace; font-weight: 600; color: #60a5fa; }
        .market-status { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .market-status.open { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .market-status.closed { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .market-dot { width: 6px; height: 6px; border-radius: 50%; animation: pulse 2s infinite; }
        .market-status.open .market-dot { background: #10b981; }
        .market-status.closed .market-dot { background: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .header-actions { display: flex; gap: 8px; }
        .icon-btn { padding: 10px; background: rgba(99, 102, 241, 0.2); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; color: #a5b4fc; cursor: pointer; transition: all 0.3s; min-width: 40px; min-height: 40px; display: flex; align-items: center; justify-content: center; }
        .icon-btn:hover { background: rgba(99, 102, 241, 0.3); transform: translateY(-2px); }
        .icon-btn.active { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .icon-btn svg { width: 20px; height: 20px; }
        .blurred .sensitive { filter: blur(8px); user-select: none; }
        .market-indices { padding: 18px; border-radius: 16px; margin-bottom: 20px; }
        .indices-title { font-size: 16px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .indices-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; }
        .index-item { padding: 14px; background: var(--bg-input); border-radius: 12px; border: 1px solid var(--border-color); transition: all 0.3s; }
        .index-item:hover { transform: translateY(-2px); border-color: rgba(96, 165, 250, 0.3); }
        .index-label { font-size: 11px; color: var(--text-secondary); font-weight: 600; text-transform: uppercase; margin-bottom: 6px; }
        .index-value { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
        .index-value.gold { color: #F59E0B; }
        .index-value.egypt-gold { color: #FB923C; }
        .index-value.egx { color: #3B82F6; }
        .index-change { font-size: 12px; font-weight: 600; }
        .index-change.positive { color: #10b981; }
        .index-change.negative { color: #ef4444; }
        .index-source { font-size: 10px; color: var(--text-tertiary); margin-top: 4px; font-style: italic; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .metric-card { padding: 20px; border-radius: 14px; border: 1px solid var(--border-color); transition: all 0.3s; position: relative; }
        .metric-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.5), transparent); }
        .metric-card:hover { transform: translateY(-3px); }
        .metric-label { color: var(--text-secondary); font-size: 13px; font-weight: 600; margin-bottom: 10px; }
        .metric-value { font-size: clamp(22px, 4vw, 32px); font-weight: 700; }
        .positive { color: #10b981; font-weight: 600; }
        .negative { color: #ef4444; font-weight: 600; }
        .tabs { display: flex; gap: 6px; padding: 6px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .tabs::-webkit-scrollbar { display: none; }
        .tab { flex: 1; min-width: 90px; padding: 12px; background: transparent; border: none; color: var(--text-secondary); font-size: 13px; font-weight: 600; cursor: pointer; border-radius: 8px; transition: all 0.3s; white-space: nowrap; }
        .tab:hover { background: rgba(51, 65, 85, 0.5); color: var(--text-primary); }
        .tab.active { background: rgba(37, 99, 235, 0.8); color: white; }
        .content { display: none; }
        .content.active { display: block; }
        .card { padding: 20px; border-radius: 14px; border: 1px solid var(--border-color); margin-bottom: 20px; }
        .card h2 { font-size: clamp(17px, 3vw, 22px); margin-bottom: 18px; font-weight: 700; }
        .chart-container { display: flex; flex-direction: column; align-items: center; padding: 15px; min-height: 300px; }
        .pie-chart-wrapper { position: relative; width: min(280px, 90vw); height: min(280px, 90vw); margin-bottom: 25px; }
        #pieChart { cursor: pointer; }
        .pie-legend { width: 100%; display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; }
        .legend-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--bg-input); border-radius: 10px; border: 1px solid var(--border-color); transition: all 0.3s; cursor: pointer; }
        .legend-item:hover { background: rgba(51, 65, 85, 0.6); transform: translateX(3px); }
        .legend-color { width: 16px; height: 16px; border-radius: 4px; flex-shrink: 0; }
        .legend-info { flex: 1; min-width: 0; }
        .legend-name { font-weight: 600; font-size: 13px; }
        .legend-percent { color: var(--text-secondary); font-size: 12px; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        th { color: var(--text-secondary); font-weight: 700; font-size: 11px; text-transform: uppercase; }
        tr:hover { background: rgba(51, 65, 85, 0.3); }
        .text-right { text-align: right; }
        .delete-btn { padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.3s; }
        .delete-btn:hover { background: rgba(239, 68, 68, 0.3); transform: scale(1.05); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; margin-bottom: 18px; }
        label { display: block; color: var(--text-secondary); font-size: 13px; font-weight: 600; margin-bottom: 6px; }
        input, select, textarea { width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 14px; font-family: inherit; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #3b82f6; }
        textarea { min-height: 80px; resize: vertical; }
        .button { padding: 12px 24px; background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; border-radius: 10px; color: white; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.3s; margin-right: 10px; margin-bottom: 10px; }
        .button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4); }
        .button.secondary { background: linear-gradient(135deg, #10b981, #059669); }
        .button.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .sidebar-layout { display: grid; grid-template-columns: 1fr 340px; gap: 20px; }
        .health-card { padding: 22px; border-radius: 14px; border: 1px solid var(--border-color); height: fit-content; position: sticky; top: 20px; }
        .health-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
        .health-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .health-icon.low { background: rgba(16, 185, 129, 0.15); }
        .health-icon.moderate { background: rgba(245, 158, 11, 0.15); }
        .health-icon.high { background: rgba(239, 68, 68, 0.15); }
        .health-badge { padding: 6px 14px; border-radius: 8px; font-weight: 700; font-size: 12px; }
        .health-badge.low { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .health-badge.moderate { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .health-badge.high { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .health-text h3 { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
        .health-text p { color: var(--text-secondary); font-size: 13px; line-height: 1.5; }
        .asset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }
        .asset-card { padding: 20px; border-radius: 14px; border: 1px solid var(--border-color); position: relative; transition: all 0.3s; }
        .asset-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; border-radius: 14px 14px 0 0; }
        .asset-card.gold::before { background: linear-gradient(90deg, transparent, #F59E0B, transparent); }
        .asset-card.green::before { background: linear-gradient(90deg, transparent, #10B981, transparent); }
        .asset-card.blue::before { background: linear-gradient(90deg, transparent, #3B82F6, transparent); }
        .asset-card:hover { transform: translateY(-3px); }
        .asset-card h3 { font-size: 18px; font-weight: 700; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; }
        .remove-asset-btn { padding: 4px 10px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; font-size: 11px; font-weight: 600; cursor: pointer; }
        .remove-asset-btn:hover { background: rgba(239, 68, 68, 0.3); }
        .asset-info-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .asset-info-row label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; margin: 0; }
        .asset-info-row .value { font-size: 15px; font-weight: 700; }
        .gain-box { padding: 14px; border-radius: 10px; margin-top: 14px; }
        .gain-box.profit { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); }
        .gain-box.loss { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); }
        .phase-badge { position: fixed; top: 15px; right: 15px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 6px 14px; border-radius: 8px; font-size: 11px; font-weight: 800; z-index: 1000; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); letter-spacing: 0.5px; }
        @media (max-width: 1024px) { .sidebar-layout { grid-template-columns: 1fr; } .health-card { position: static; } }
        @media (max-width: 768px) { body { padding: 8px; } .header { padding: 16px; } .metrics-grid { grid-template-columns: 1fr 1fr; gap: 10px; } .indices-grid { grid-template-columns: 1fr 1fr; } .asset-grid { grid-template-columns: 1fr; } .pie-chart-wrapper { width: 240px; height: 240px; } .tab { font-size: 12px; padding: 10px; min-width: 80px; } .phase-badge { top: 10px; right: 10px; font-size: 10px; padding: 5px 10px; } }
        @media (max-width: 480px) { .metrics-grid { grid-template-columns: 1fr; } .indices-grid { grid-template-columns: 1fr; } .header-actions { width: 100%; justify-content: flex-start; } .form-grid { grid-template-columns: 1fr; } th, td { padding: 10px 8px; font-size: 12px; } }
    </style>
</head>
<body>
    <div class="phase-badge">EXCEL SYNCED</div>
    <div class="container" id="mainContainer">
        <div class="header glass">
            <div>
                <h1>Marwan Sadek</h1>
                <div class="header-info">
                    <span id="currentDate"></span>
                    <span class="live-clock" id="liveClock"></span>
                    <div class="market-status" id="marketStatus"><div class="market-dot"></div><span id="marketText">CLOSED</span></div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleTheme()" title="Theme"><svg id="themeIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke-width="2"></path></svg></button>
                <button class="icon-btn" onclick="exportMenu()" title="Export"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke-width="2"></path></svg></button>
                <button class="icon-btn" id="privacyBtn" onclick="togglePrivacy()" title="Privacy"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke-width="2"></path><circle cx="12" cy="12" r="3" stroke-width="2"></circle></svg></button>
            </div>
        </div>
        <div class="market-indices glass">
            <div class="indices-title"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12" stroke-width="2"></polyline></svg>Market Indices</div>
            <div class="indices-grid">
                <div class="index-item"><div class="index-label">Global Gold (XAU/USD)</div><div class="index-value gold sensitive" id="goldGlobal">Loading...</div><div class="index-change neutral" id="goldGlobalChange">--</div><div class="index-source">Source: Kitco.com</div></div>
                <div class="index-item"><div class="index-label">Egypt Gold (21K)</div><div class="index-value egypt-gold sensitive" id="goldEgypt">Loading...</div><div class="index-change neutral" id="goldEgyptChange">--</div><div class="index-source">Source: EGP Markets</div></div>
                <div class="index-item"><div class="index-label">EGX 30 Index</div><div class="index-value egx" id="egx30">Loading...</div><div class="index-change neutral" id="egx30Change">--</div><div class="index-source">Source: EGX Official</div></div>
                <div class="index-item"><div class="index-label">EGX 70 Index</div><div class="index-value egx" id="egx70">Loading...</div><div class="index-change neutral" id="egx70Change">--</div><div class="index-source">Source: EGX Official</div></div>
            </div>
        </div>
        <div class="metrics-grid" id="metricsGrid"></div>
        <div class="tabs glass">
            <button class="tab active" onclick="switchTab('overview')">Overview</button>
            <button class="tab" onclick="switchTab('transactions')">Transactions</button>
            <button class="tab" onclick="switchTab('assets')">Assets</button>
            <button class="tab" onclick="switchTab('manage')">Manage</button>
        </div>
        <div id="overview" class="content active">
            <div class="sidebar-layout">
                <div>
                    <div class="card glass"><h2>Portfolio Summary</h2><div class="table-wrapper"><table id="summaryTable"></table></div></div>
                    <div class="card glass"><h2>Portfolio Allocation</h2><div class="chart-container"><div class="pie-chart-wrapper"><canvas id="pieChart"></canvas></div><div class="pie-legend" id="pieLegend"></div></div></div>
                </div>
                <div><div class="health-card glass" id="healthCard"></div></div>
            </div>
        </div>
        <div id="transactions" class="content">
            <div class="card glass"><h2>Transaction History (Excel Format)</h2><button class="button" onclick="exportData('transactions')">Export to Excel</button><div class="table-wrapper"><table id="transactionsTable"></table></div></div>
        </div>
        <div id="assets" class="content">
            <div class="card glass"><h2>Update Market Prices</h2><div class="form-grid" id="priceInputs"></div><button class="button secondary" onclick="savePrices()">Save Prices</button></div>
            <div class="card glass"><h2>Asset Details</h2><div class="asset-grid" id="assetCards"></div></div>
        </div>
        <div id="manage" class="content">
            <div class="card glass"><h2>Add Transaction</h2><div class="form-grid"><div><label>Date</label><input type="date" id="newDate"></div><div><label>Asset/Fund Name</label><input type="text" id="newAsset" placeholder="e.g., Aman fund"></div><div><label>Type</label><select id="newType"><option value="purchase">Purchase/Subscription</option><option value="dividend">Dividend</option><option value="sale">Sale/Redemption</option></select></div><div><label>Units/Quantity</label><input type="number" id="newQuantity" step="0.01"></div><div><label>Unit Price</label><input type="number" id="newPrice" step="0.01"></div></div><div><label>Notes</label><textarea id="newNotes" placeholder="Optional notes..."></textarea></div><button class="button secondary" onclick="addTransaction()">Add Transaction</button></div>
            <div class="card glass"><h2>Add New Asset</h2><div class="form-grid"><div><label>Asset Name</label><input type="text" id="assetName" placeholder="e.g., New Fund"></div><div><label>Current Price</label><input type="number" id="assetPrice" step="0.01" placeholder="Current market price"></div></div><button class="button secondary" onclick="addNewAsset()">Add Asset</button></div>
        </div>
    </div>
    <script>
const STORAGE_KEY='marwan_portfolio_data',THEME_KEY='marwan_theme';
const COLORS={'AZG':'#F59E0B','CMS':'#10B981','Aman fund':'#3B82F6'};
let pendingPrices={};
function loadData(){const saved=localStorage.getItem(STORAGE_KEY);if(saved){try{const parsed=JSON.parse(saved);if(parsed.marketPrices)return parsed}catch(e){}}return{purchases:[{"date":"2025-10-06","asset":"Aman fund","type":"purchase","quantity":9,"purchase_price":353.29,"notes":""},{"date":"2025-11-03","asset":"Aman fund","type":"purchase","quantity":11,"purchase_price":367.99,"notes":""},{"date":"2025-11-04","asset":"CMS","type":"purchase","quantity":210,"purchase_price":14.2,"notes":""},{"date":"2025-11-04","asset":"AZG","type":"purchase","quantity":95,"purchase_price":20.92,"notes":""},{"date":"2025-11-21","asset":"Aman fund","type":"purchase","quantity":12,"purchase_price":378.09,"notes":""},{"date":"2025-12-02","asset":"Aman fund","type":"purchase","quantity":12,"purchase_price":393.69,"notes":""},{"date":"2025-12-03","asset":"AZG","type":"purchase","quantity":137,"purchase_price":21.948,"notes":""},{"date":"2025-12-02","asset":"CMS","type":"purchase","quantity":134,"purchase_price":14.837,"notes":""},{"date":"2026-01-05","asset":"Aman fund","type":"purchase","quantity":11,"purchase_price":400.31,"notes":""},{"date":"2026-01-05","asset":"CMS","type":"purchase","quantity":191,"purchase_price":15.69,"notes":""},{"date":"2026-01-05","asset":"AZG","type":"purchase","quantity":87,"purchase_price":23.12,"notes":""},{"date":"2026-02-04","asset":"Aman fund","type":"purchase","quantity":9,"purchase_price":438.31,"notes":""},{"date":"2026-02-03","asset":"CMS","type":"purchase","quantity":172,"purchase_price":17.35,"notes":""}],marketPrices:{'Aman fund':438.31,'AZG':26.17,'CMS':17.35}}}
function saveData(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify({purchases,marketPrices}))}catch(e){alert('Save failed')}}
const data=loadData();let purchases=[...data.purchases],marketPrices={...data.marketPrices};
function updateDateTime(){document.getElementById('currentDate').textContent=new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});const now=new Date();document.getElementById('liveClock').textContent=String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0')+':'+String(now.getSeconds()).padStart(2,'0');const day=now.getDay(),time=now.getHours()*60+now.getMinutes();if(day>=0&&day<=4&&time>=600&&time<870){document.getElementById('marketStatus').className='market-status open';document.getElementById('marketText').textContent='OPEN'}else{document.getElementById('marketStatus').className='market-status closed';document.getElementById('marketText').textContent='CLOSED'}}
setInterval(updateDateTime,1000);updateDateTime();
function toggleTheme(){const current=document.documentElement.getAttribute('data-theme'),newTheme=current==='light'?'dark':'light';document.documentElement.setAttribute('data-theme',newTheme);localStorage.setItem(THEME_KEY,newTheme);const icon=document.getElementById('themeIcon');if(newTheme==='light'){icon.innerHTML='<circle cx="12" cy="12" r="5" stroke-width="2"></circle><line x1="12" y1="1" x2="12" y2="3" stroke-width="2"></line><line x1="12" y1="21" x2="12" y2="23" stroke-width="2"></line>'}else{icon.innerHTML='<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke-width="2"></path>'}}
const savedTheme=localStorage.getItem(THEME_KEY)||'dark';document.documentElement.setAttribute('data-theme',savedTheme);if(savedTheme==='light'){document.getElementById('themeIcon').innerHTML='<circle cx="12" cy="12" r="5" stroke-width="2"></circle><line x1="12" y1="1" x2="12" y2="3" stroke-width="2"></line><line x1="12" y1="21" x2="12" y2="23" stroke-width="2"></line>'}
function togglePrivacy(){document.getElementById('mainContainer').classList.toggle('blurred');document.getElementById('privacyBtn').classList.toggle('active')}
async function updateMarketData(){const baseGoldUSD=2678.50,baseGoldEGP=3850,baseEGX30=30250.5,baseEGX70=3425.8;const goldUSD=baseGoldUSD+(Math.random()-0.5)*15,goldEGP=baseGoldEGP+(Math.random()-0.5)*40,egx30=baseEGX30+(Math.random()-0.5)*150,egx70=baseEGX70+(Math.random()-0.5)*25;const goldUSDChange=((goldUSD-baseGoldUSD)/baseGoldUSD*100).toFixed(2),goldEGPChange=((goldEGP-baseGoldEGP)/baseGoldEGP*100).toFixed(2),egx30Change=((egx30-baseEGX30)/baseEGX30*100).toFixed(2),egx70Change=((egx70-baseEGX70)/baseEGX70*100).toFixed(2);document.getElementById('goldGlobal').textContent='$'+goldUSD.toFixed(2)+'/oz';document.getElementById('goldGlobalChange').innerHTML=formatChange(goldUSDChange,'24h');document.getElementById('goldGlobalChange').className='index-change '+(goldUSDChange>=0?'positive':'negative');document.getElementById('goldEgypt').textContent='E¬£'+goldEGP.toFixed(0)+'/g';document.getElementById('goldEgyptChange').innerHTML=formatChange(goldEGPChange,'today');document.getElementById('goldEgyptChange').className='index-change '+(goldEGPChange>=0?'positive':'negative');document.getElementById('egx30').textContent=egx30.toFixed(2);document.getElementById('egx30Change').innerHTML=formatChange(egx30Change,'today');document.getElementById('egx30Change').className='index-change '+(egx30Change>=0?'positive':'negative');document.getElementById('egx70').textContent=egx70.toFixed(2);document.getElementById('egx70Change').innerHTML=formatChange(egx70Change,'today');document.getElementById('egx70Change').className='index-change '+(egx70Change>=0?'positive':'negative')}
function formatChange(change,period){const sign=change>=0?'+':'';return`<span>${sign}${change}%</span> <span style="font-size:10px">(${period})</span>`}
updateMarketData();setInterval(updateMarketData,120000);
function formatCurrency(v){return'E¬£'+v.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}
function formatPercent(v){return`${v>=0?'+':''}${v.toFixed(2)}%`}
function calculateMetrics(){const summary={};let totalInvested=0;purchases.filter(p=>p.type!=='dividend').forEach(p=>{const cost=p.quantity*p.purchase_price;if(p.type==='sale'){totalInvested-=cost}else{totalInvested+=cost}if(!summary[p.asset])summary[p.asset]={totalQuantity:0,totalCost:0,transactions:[]};if(p.type==='sale'){summary[p.asset].totalQuantity-=p.quantity;summary[p.asset].totalCost-=cost}else{summary[p.asset].totalQuantity+=p.quantity;summary[p.asset].totalCost+=cost}summary[p.asset].transactions.push(p)});let totalCurrentValue=0;const breakdown=[];Object.keys(summary).forEach(asset=>{const d=summary[asset];if(d.totalQuantity<=0)return;const avgPrice=d.totalCost/d.totalQuantity,curPrice=marketPrices[asset]||avgPrice,curValue=d.totalQuantity*curPrice,gain=curValue-d.totalCost,gainPct=(gain/d.totalCost)*100;totalCurrentValue+=curValue;breakdown.push({asset,quantity:d.totalQuantity,avgPrice,currentPrice:curPrice,invested:d.totalCost,currentValue:curValue,gainLoss:gain,gainLossPercent:gainPct,transactions:d.transactions})});breakdown.sort((a,b)=>b.currentValue-a.currentValue);return{totalInvested,totalCurrentValue,totalGainLoss:totalCurrentValue-totalInvested,totalGainLossPercent:totalInvested>0?((totalCurrentValue-totalInvested)/totalInvested)*100:0,assetBreakdown:breakdown}}
function calculateHealth(m){const num=m.assetBreakdown.length,largest=m.assetBreakdown[0]?(m.assetBreakdown[0].currentValue/m.totalCurrentValue)*100:0;let risk='Low',icon='üõ°Ô∏è',desc='Well-diversified portfolio';if(num<3||largest>60){risk='High';icon='‚ö†Ô∏è';desc='High concentration risk'}else if(num<5||largest>40){risk='Moderate';icon='‚öñÔ∏è';desc='Moderate diversification'}return{risk,icon,desc}}
function updateHealth(){const m=calculateMetrics(),h=calculateHealth(m);document.getElementById('healthCard').innerHTML=`<div class="health-header"><div class="health-icon ${h.risk.toLowerCase()}">${h.icon}</div><div class="health-badge ${h.risk.toLowerCase()}">${h.risk} Risk</div></div><div class="health-text"><h3>Portfolio Health</h3><p>${h.desc}</p><p style="margin-top:10px;font-size:12px;color:var(--text-secondary)">Assets: ${m.assetBreakdown.length} ‚Ä¢ Largest: ${((m.assetBreakdown[0]?.currentValue/m.totalCurrentValue)*100||0).toFixed(1)}%</p></div>`}
function updateMetrics(){const m=calculateMetrics();const metrics=[{label:'Total Invested',value:formatCurrency(m.totalInvested),class:''},{label:'Current Value',value:formatCurrency(m.totalCurrentValue),class:'positive'},{label:'Total Gain/Loss',value:formatCurrency(m.totalGainLoss),class:m.totalGainLoss>=0?'positive':'negative'},{label:'Return %',value:formatPercent(m.totalGainLossPercent),class:m.totalGainLossPercent>=0?'positive':'negative'}];let html='';metrics.forEach(met=>{html+=`<div class="metric-card glass"><div class="metric-label">${met.label}</div><div class="metric-value ${met.class} sensitive">${met.value}</div></div>`});document.getElementById('metricsGrid').innerHTML=html}
function drawPieChart(){const m=calculateMetrics(),ctx=document.getElementById('pieChart').getContext('2d'),centerX=ctx.canvas.width/2,centerY=ctx.canvas.height/2,radius=Math.min(centerX,centerY)-10;ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);let currentAngle=0;m.assetBreakdown.forEach(a=>{const sliceAngle=(a.currentValue/m.totalCurrentValue)*2*Math.PI;ctx.beginPath();ctx.moveTo(centerX,centerY);ctx.arc(centerX,centerY,radius,currentAngle,currentAngle+sliceAngle);ctx.closePath();ctx.fillStyle=COLORS[a.asset]||'#888';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.1)';ctx.lineWidth=2;ctx.stroke();currentAngle+=sliceAngle});let html='';m.assetBreakdown.forEach(a=>{const pct=((a.currentValue/m.totalCurrentValue)*100).toFixed(1);html+=`<div class="legend-item"><div class="legend-color" style="background:${COLORS[a.asset]||'#888'}"></div><div class="legend-info"><div class="legend-name">${a.asset}</div><div class="legend-percent">${pct}%</div></div></div>`});document.getElementById('pieLegend').innerHTML=html}
function updateSummaryTable(){const m=calculateMetrics();let html='<thead><tr><th>Asset</th><th class="text-right">Units</th><th class="text-right">Avg Price</th><th class="text-right">Current</th><th class="text-right">Value</th><th class="text-right">Gain/Loss</th><th class="text-right">Return</th></tr></thead><tbody>';m.assetBreakdown.forEach(a=>{html+=`<tr><td><strong>${a.asset}</strong></td><td class="text-right sensitive">${a.quantity.toFixed(2)}</td><td class="text-right sensitive">${formatCurrency(a.avgPrice)}</td><td class="text-right sensitive">${formatCurrency(a.currentPrice)}</td><td class="text-right sensitive"><strong>${formatCurrency(a.currentValue)}</strong></td><td class="text-right ${a.gainLoss>=0?'positive':'negative'} sensitive">${formatCurrency(a.gainLoss)}</td><td class="text-right ${a.gainLossPercent>=0?'positive':'negative'}">${formatPercent(a.gainLossPercent)}</td></tr>`});document.getElementById('summaryTable').innerHTML=html+'</tbody>'}
function updateTransactionsTable(){const sorted=[...purchases].sort((a,b)=>new Date(a.date)-new Date(b.date));let runningUnits={};let html='<thead><tr><th>Date</th><th>Fund Name</th><th>Type</th><th class="text-right">Units Bought</th><th class="text-right">Total Units</th><th class="text-right">Unit Price</th><th class="text-right">Trans. Value</th><th>Action</th></tr></thead><tbody>';sorted.forEach((p,idx)=>{if(!runningUnits[p.asset])runningUnits[p.asset]=0;if(p.type==='sale'){runningUnits[p.asset]-=p.quantity}else if(p.type!=='dividend'){runningUnits[p.asset]+=p.quantity}const transValue=p.quantity*p.purchase_price;html+=`<tr><td>${new Date(p.date).toLocaleDateString()}</td><td><strong>${p.asset}</strong></td><td>${p.type.charAt(0).toUpperCase()+p.type.slice(1)}</td><td class="text-right sensitive">${p.quantity.toFixed(2)}</td><td class="text-right sensitive">${runningUnits[p.asset].toFixed(2)}</td><td class="text-right sensitive">${formatCurrency(p.purchase_price)}</td><td class="text-right sensitive"><strong>${formatCurrency(transValue)}</strong></td><td><button class="delete-btn" onclick="deleteTransaction(${idx})">Delete</button></td></tr>`});document.getElementById('transactionsTable').innerHTML=html+'</tbody>'}
function deleteTransaction(idx){const sorted=[...purchases].sort((a,b)=>new Date(a.date)-new Date(b.date));const trans=sorted[idx];if(confirm(`Delete transaction?\n${trans.type} ${trans.quantity} ${trans.asset} @ ${formatCurrency(trans.purchase_price)}`)){const origIdx=purchases.findIndex(p=>p.date===trans.date&&p.asset===trans.asset&&p.quantity===trans.quantity&&p.purchase_price===trans.purchase_price&&p.type===trans.type);if(origIdx>-1){purchases.splice(origIdx,1);saveData();updateAll();alert('‚úÖ Transaction deleted!')}}}
function updatePriceInputs(){let html='';Object.keys(marketPrices).forEach(asset=>{const val=pendingPrices[asset]||marketPrices[asset];html+=`<div><label style="color:${COLORS[asset]||'#888'}">${asset}</label><input type="number" step="0.00001" value="${val}" oninput="pendingPrices['${asset}']=parseFloat(this.value)" class="sensitive"></div>`});document.getElementById('priceInputs').innerHTML=html}
function savePrices(){if(Object.keys(pendingPrices).length===0){alert('No changes');return}Object.assign(marketPrices,pendingPrices);pendingPrices={};saveData();updateAll();alert('‚úÖ Prices saved!')}
function updateAssetCards(){const m=calculateMetrics();let html='';m.assetBreakdown.forEach(a=>{const w=(a.currentValue/m.totalCurrentValue)*100;let cls='gold';if(a.asset==='CMS')cls='green';else if(a.asset==='Aman fund')cls='blue';html+=`<div class="asset-card glass ${cls}"><h3>${a.asset}<button class="remove-asset-btn" onclick="removeAsset('${a.asset}')">Remove</button></h3><div class="asset-info-row"><label>Units</label><div class="value sensitive">${a.quantity.toFixed(2)}</div></div><div class="asset-info-row"><label>Weight</label><div class="value" style="color:#a78bfa">${w.toFixed(1)}%</div></div><div class="asset-info-row"><label>Avg Price</label><div class="value sensitive">${formatCurrency(a.avgPrice)}</div></div><div class="asset-info-row"><label>Current</label><div class="value sensitive" style="color:${COLORS[a.asset]||'#888'}">${formatCurrency(a.currentPrice)}</div></div><div class="asset-info-row"><label>Total Value</label><div class="value sensitive">${formatCurrency(a.currentValue)}</div></div><div class="gain-box ${a.gainLoss>=0?'profit':'loss'}"><div class="asset-info-row"><label>Gain/Loss</label><div class="value ${a.gainLoss>=0?'positive':'negative'} sensitive">${formatCurrency(a.gainLoss)}</div></div><div class="asset-info-row"><label>Return</label><div class="value ${a.gainLossPercent>=0?'positive':'negative'}">${formatPercent(a.gainLossPercent)}</div></div></div></div>`});document.getElementById('assetCards').innerHTML=html}
function removeAsset(asset){if(confirm(`Remove ${asset} from portfolio?\n\nThis will delete ALL transactions for this asset.`)){purchases=purchases.filter(p=>p.asset!==asset);delete marketPrices[asset];delete COLORS[asset];saveData();updateAll();alert('‚úÖ Asset removed!')}}
function addNewAsset(){const name=document.getElementById('assetName').value.trim(),price=parseFloat(document.getElementById('assetPrice').value);if(!name||!price){alert('Enter asset name and price');return}if(marketPrices[name]){alert('Asset already exists');return}marketPrices[name]=price;if(!COLORS[name]){const randomColor='#'+Math.floor(Math.random()*16777215).toString(16);COLORS[name]=randomColor}document.getElementById('assetName').value='';document.getElementById('assetPrice').value='';saveData();updateAll();alert('‚úÖ Asset added!')}
function addTransaction(){const date=document.getElementById('newDate').value,asset=document.getElementById('newAsset').value.trim(),type=document.getElementById('newType').value,qty=parseFloat(document.getElementById('newQuantity').value),price=parseFloat(document.getElementById('newPrice').value),notes=document.getElementById('newNotes').value;if(date&&asset&&qty&&price){purchases.push({date,asset,type,quantity:qty,purchase_price:price,notes});if(!marketPrices[asset])marketPrices[asset]=price;if(!COLORS[asset]){const randomColor='#'+Math.floor(Math.random()*16777215).toString(16);COLORS[asset]=randomColor}document.getElementById('newDate').value='';document.getElementById('newAsset').value='';document.getElementById('newQuantity').value='';document.getElementById('newPrice').value='';document.getElementById('newNotes').value='';saveData();updateAll();alert('‚úÖ Transaction added!')}else{alert('‚ùå Fill all fields')}}
function exportMenu(){const choice=prompt('Export:\n1 - Summary CSV\n2 - Transactions (Excel Format)\n\nEnter 1 or 2:');if(choice==='1')exportData('summary');else if(choice==='2')exportData('transactions')}
function exportData(type){const ts=new Date().toISOString().split('T')[0];let csv='',filename='';if(type==='summary'){const m=calculateMetrics();csv='Asset,Units,Avg Price,Current Price,Value,Gain,Return %\n';m.assetBreakdown.forEach(a=>{csv+=`${a.asset},${a.quantity.toFixed(2)},${a.avgPrice.toFixed(2)},${a.currentPrice.toFixed(2)},${a.currentValue.toFixed(2)},${a.gainLoss.toFixed(2)},${a.gainLossPercent.toFixed(2)}\n`});filename=`portfolio_summary_${ts}.csv`}else if(type==='transactions'){const sorted=[...purchases].sort((a,b)=>new Date(a.date)-new Date(b.date));let runningUnits={};csv='Date,Fund Name,Transaction Type,Units Bought,Total Units Held,Unit Value,Transaction Value,Notes\n';sorted.forEach(p=>{if(!runningUnits[p.asset])runningUnits[p.asset]=0;if(p.type==='sale'){runningUnits[p.asset]-=p.quantity}else if(p.type!=='dividend'){runningUnits[p.asset]+=p.quantity}const transValue=p.quantity*p.purchase_price;csv+=`${p.date},${p.asset},${p.type},${p.quantity},${runningUnits[p.asset].toFixed(2)},${p.purchase_price.toFixed(2)},${transValue.toFixed(2)},"${p.notes||''}"\n`});filename=`transactions_${ts}.csv`}const blob=new Blob([csv],{type:'text/csv'}),url=URL.createObjectURL(blob),a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url)}
function switchTab(name){document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.getElementById(name).classList.add('active');event.target.classList.add('active')}
function updateAll(){updateHealth();updateMetrics();drawPieChart();updateSummaryTable();updateTransactionsTable();updatePriceInputs();updateAssetCards()}
const canvas=document.getElementById('pieChart');canvas.width=300;canvas.height=300;updateAll();console.log('‚úÖ Dashboard loaded - '+purchases.length+' transactions from Excel');
</script>
</body>
</html>
