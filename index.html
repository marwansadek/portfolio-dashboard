<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marwan Sadek - Investment Portfolio</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            --bg-card: rgba(30, 41, 59, 0.8);
            --bg-input: rgba(51, 65, 85, 0.6);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: white;
            --text-secondary: #94a3b8;
            --gold: #F59E0B;
            --green: #10B981;
            --blue: #3B82F6;
            --red: #EF4444;
        }
        
        [data-theme="light"] {
            --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f8fafc 100%);
            --bg-card: rgba(255, 255, 255, 0.95);
            --bg-input: rgba(241, 245, 249, 0.9);
            --border-color: rgba(0, 0, 0, 0.08);
            --text-primary: #0f172a;
            --text-secondary: #475569;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-primary);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.6;
        }
        
        .container { max-width: 1600px; margin: 0 auto; }
        
        .glass {
            background: var(--bg-card);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
        }
        
        /* Header */
        .header {
            padding: 20px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .header h1 {
            font-size: clamp(24px, 5vw, 36px);
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        .header-info {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .live-clock {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #60a5fa;
            font-size: 14px;
        }
        
        .market-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .market-badge.open { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .market-badge.closed { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .market-dot { width: 6px; height: 6px; border-radius: 50%; animation: pulse 2s infinite; }
        .market-badge.open .market-dot { background: #10b981; }
        .market-badge.closed .market-dot { background: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .icon-btn {
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.25);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #a5b4fc;
        }
        
        .icon-btn:hover { background: rgba(99, 102, 241, 0.25); transform: translateY(-2px); }
        .icon-btn.active { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .icon { width: 20px; height: 20px; stroke-width: 2; }
        
        /* Market Tracker Grid */
        .market-tracker {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .tracker-card {
            padding: 18px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid;
        }
        
        .tracker-card.gold { 
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.12), rgba(217, 119, 6, 0.08));
            border-color: rgba(245, 158, 11, 0.3);
        }
        
        .tracker-card.egx { 
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(37, 99, 235, 0.08));
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .tracker-card.egypt-gold { 
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.12), rgba(249, 115, 22, 0.08));
            border-color: rgba(251, 146, 60, 0.3);
        }
        
        .tracker-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .tracker-card.gold .tracker-icon { background: rgba(245, 158, 11, 0.2); }
        .tracker-card.egx .tracker-icon { background: rgba(59, 130, 246, 0.2); }
        .tracker-card.egypt-gold .tracker-icon { background: rgba(251, 146, 60, 0.2); }
        
        .tracker-info { flex: 1; min-width: 0; }
        .tracker-label { font-size: 11px; color: var(--text-secondary); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .tracker-value { font-size: 22px; font-weight: 800; margin-top: 4px; }
        .tracker-card.gold .tracker-value { color: #F59E0B; }
        .tracker-card.egx .tracker-value { color: #3B82F6; }
        .tracker-card.egypt-gold .tracker-value { color: #FB923C; }
        
        .tracker-change {
            font-size: 13px;
            font-weight: 700;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .tracker-change.positive { color: #10b981; }
        .tracker-change.negative { color: #ef4444; }
        .tracker-change.neutral { color: var(--text-secondary); }
        
        /* Metrics Grid */
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric {
            padding: 22px;
            border-radius: 14px;
            position: relative;
            overflow: hidden;
            cursor: help;
            transition: all 0.3s;
        }
        
        .metric::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.6), transparent);
        }
        
        .metric:hover { transform: translateY(-4px); }
        .metric-label { font-size: 13px; color: var(--text-secondary); font-weight: 600; margin-bottom: 10px; }
        .metric-value { font-size: clamp(26px, 5vw, 34px); font-weight: 800; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 6px;
            padding: 6px;
            margin-bottom: 20px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .tabs::-webkit-scrollbar { display: none; }
        
        .tab {
            flex: 1;
            min-width: 110px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .tab:hover { background: rgba(51, 65, 85, 0.3); color: var(--text-primary); }
        .tab.active { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        
        /* Content */
        .content { display: none; }
        .content.active { display: block; }
        
        .card {
            padding: 24px;
            margin-bottom: 20px;
            border-radius: 14px;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .card-header h2 {
            font-size: clamp(18px, 3vw, 22px);
            font-weight: 700;
            flex: 1;
        }
        
        .card-icon { width: 24px; height: 24px; }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 320px;
            margin: 20px 0;
        }
        
        /* Tables */
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 14px 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        th { 
            color: var(--text-secondary); 
            font-weight: 700; 
            font-size: 11px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            background: rgba(0, 0, 0, 0.02);
        }
        tr:hover { background: rgba(51, 65, 85, 0.15); }
        .text-right { text-align: right; }
        
        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 14px;
            background: var(--bg-input);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        textarea { min-height: 90px; resize: vertical; }
        
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4); }
        .btn.secondary { background: linear-gradient(135deg, #10b981, #059669); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .btn.secondary:hover { box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4); }
        
        /* Sidebar Layout */
        .sidebar-layout {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 20px;
        }
        
        /* Health Card */
        .health-card {
            padding: 24px;
            border-radius: 14px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .health-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .health-icon {
            width: 54px;
            height: 54px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
        }
        
        .health-icon.low { background: rgba(16, 185, 129, 0.15); }
        .health-icon.moderate { background: rgba(245, 158, 11, 0.15); }
        .health-icon.high { background: rgba(239, 68, 68, 0.15); }
        
        .health-badge {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 800;
            font-size: 13px;
        }
        
        .health-badge.low { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .health-badge.moderate { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .health-badge.high { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        
        .health-text h3 { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
        .health-text p { color: var(--text-secondary); font-size: 14px; line-height: 1.6; }
        
        /* Asset Cards */
        .asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }
        
        .asset-card {
            padding: 24px;
            border-radius: 14px;
            position: relative;
            transition: all 0.3s;
        }
        
        .asset-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 14px 14px 0 0;
        }
        
        .asset-card.gold::before { background: linear-gradient(90deg, transparent, #F59E0B, transparent); }
        .asset-card.green::before { background: linear-gradient(90deg, transparent, #10B981, transparent); }
        .asset-card.blue::before { background: linear-gradient(90deg, transparent, #3B82F6, transparent); }
        
        .asset-card:hover { transform: translateY(-4px); }
        
        .asset-card h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .asset-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .asset-info-item label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .asset-info-item .value {
            font-size: 17px;
            font-weight: 700;
        }
        
        .gain-box {
            padding: 16px;
            border-radius: 10px;
            margin-top: 16px;
        }
        
        .gain-box.profit { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); }
        .gain-box.loss { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); }
        
        .gain-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        
        .gain-row + .gain-row { margin-top: 8px; }
        .gain-row label { font-size: 12px; color: var(--text-secondary); margin: 0; }
        .gain-row .value { font-weight: 800; }
        
        /* Rebalance */
        .rebalance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-input);
            border-radius: 10px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }
        
        .rebalance-action {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
        }
        
        .rebalance-action.buy { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .rebalance-action.sell { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .rebalance-action.hold { background: rgba(100, 116, 139, 0.15); color: #94a3b8; }
        
        /* Benchmarks */
        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 20px;
        }
        
        .benchmark-card {
            padding: 18px;
            background: var(--bg-input);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .benchmark-card h4 { font-size: 12px; color: var(--text-secondary); margin-bottom: 10px; font-weight: 700; text-transform: uppercase; }
        .benchmark-card .value { font-size: 24px; font-weight: 800; }
        .benchmark-card .sub { font-size: 13px; color: var(--text-secondary); margin-top: 6px; }
        
        /* Privacy */
        .blurred .sensitive { filter: blur(6px); user-select: none; }
        
        /* Phase Badge */
        .phase-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 800;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            letter-spacing: 0.5px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar-layout { grid-template-columns: 1fr; }
            .health-card { position: static; }
        }
        
        @media (max-width: 768px) {
            body { padding: 8px; }
            .header { grid-template-columns: 1fr; }
            .header-actions { width: 100%; justify-content: flex-start; }
            .market-tracker { grid-template-columns: 1fr; }
            .metrics { grid-template-columns: 1fr 1fr; }
            .asset-grid { grid-template-columns: 1fr; }
            .chart-container { height: 260px; }
            .phase-badge { top: 10px; right: 10px; font-size: 10px; padding: 6px 12px; }
        }
        
        @media (max-width: 480px) {
            .metrics { grid-template-columns: 1fr; }
            .tabs { gap: 4px; }
            .tab { min-width: 90px; padding: 10px 12px; font-size: 12px; }
        }
        
        /* Landscape mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .chart-container { height: 220px; }
            .health-card { position: static; }
        }
    </style>
</head>
<body>
    <div class="phase-badge">PHASE 3 PRO</div>
    
    <div class="container" id="mainContainer">
        <div class="header glass">
            <div>
                <h1>Marwan Sadek</h1>
                <div class="header-info">
                    <span id="currentDate"></span>
                    <span class="live-clock" id="liveClock"></span>
                    <div class="market-badge" id="marketStatus">
                        <div class="market-dot"></div>
                        <span id="marketText">CLOSED</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleTheme()" title="Toggle Theme">
                    <svg class="icon" id="themeIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <button class="icon-btn" onclick="exportMenu()" title="Export Data">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"></path>
                    </svg>
                </button>
                <button class="icon-btn" id="privacyBtn" onclick="togglePrivacy()" title="Privacy Mode">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="market-tracker">
            <div class="tracker-card gold glass">
                <div class="tracker-icon">
                    <svg width="28" height="28" fill="none" stroke="#F59E0B" stroke-width="2.5" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                    </svg>
                </div>
                <div class="tracker-info">
                    <div class="tracker-label">Global Gold (XAU/USD)</div>
                    <div class="tracker-value sensitive" id="goldPriceGlobal">Loading...</div>
                    <div class="tracker-change neutral" id="goldChangeGlobal">--</div>
                </div>
            </div>
            
            <div class="tracker-card egypt-gold glass">
                <div class="tracker-icon">
                    <svg width="28" height="28" fill="none" stroke="#FB923C" stroke-width="2.5" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                </div>
                <div class="tracker-info">
                    <div class="tracker-label">Egypt Gold (21K per gram)</div>
                    <div class="tracker-value sensitive" id="goldPriceEgypt">Loading...</div>
                    <div class="tracker-change neutral" id="goldChangeEgypt">--</div>
                </div>
            </div>
            
            <div class="tracker-card egx glass">
                <div class="tracker-icon">
                    <svg width="28" height="28" fill="none" stroke="#3B82F6" stroke-width="2.5" viewBox="0 0 24 24">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                        <polyline points="17 6 23 6 23 12"></polyline>
                    </svg>
                </div>
                <div class="tracker-info">
                    <div class="tracker-label">EGX 30 Index</div>
                    <div class="tracker-value" id="egxIndex">Loading...</div>
                    <div class="tracker-change neutral" id="egxChange">--</div>
                </div>
            </div>
        </div>
        
        <div class="metrics" id="metricsGrid"></div>
        
        <div class="tabs glass">
            <button class="tab active" onclick="switchTab('overview')">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                Overview
            </button>
            <button class="tab" onclick="switchTab('performance')">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                </svg>
                Performance
            </button>
            <button class="tab" onclick="switchTab('rebalance')">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6"></path>
                </svg>
                Rebalance
            </button>
            <button class="tab" onclick="switchTab('assets')">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="2" y="7" width="20" height="14" rx="2"></rect>
                </svg>
                Assets
            </button>
            <button class="tab" onclick="switchTab('manage')">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Manage
            </button>
            <button class="tab" onclick="switchTab('projections')">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <line x1="12" y1="20" x2="12" y2="10"></line>
                    <line x1="18" y1="20" x2="18" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="16"></line>
                </svg>
                Projections
            </button>
        </div>
        
        <div id="overview" class="content active">
            <div class="sidebar-layout">
                <div>
                    <div class="card glass">
                        <div class="card-header">
                            <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M9 11l3 3L22 4"></path>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                            </svg>
                            <h2>Asset Performance</h2>
                        </div>
                        <div class="table-wrapper"><table id="performanceTable"></table></div>
                    </div>
                    
                    <div class="card glass">
                        <div class="card-header">
                            <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"></circle>
                            </svg>
                            <h2>Portfolio Allocation</h2>
                        </div>
                        <div class="chart-container"><canvas id="allocationChart"></canvas></div>
                    </div>
                </div>
                
                <div><div class="health-card glass" id="healthCard"></div></div>
            </div>
        </div>
        
        <div id="performance" class="content">
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                    </svg>
                    <h2>Performance Timeline</h2>
                </div>
                <div class="chart-container"><canvas id="performanceChart"></canvas></div>
            </div>
            
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                    </svg>
                    <h2>Benchmark Comparison</h2>
                </div>
                <div class="benchmark-grid" id="benchmarkGrid"></div>
                <div class="chart-container"><canvas id="benchmarkChart"></canvas></div>
            </div>
            
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"></path>
                    </svg>
                    <h2>Dividends & Income</h2>
                </div>
                <div id="dividendTracker"></div>
            </div>
        </div>
        
        <div id="rebalance" class="content">
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <h2>Target Allocation</h2>
                </div>
                <div class="form-grid" id="targetAllocationForm"></div>
                <button class="btn secondary" onclick="calculateRebalance()">Calculate Rebalancing</button>
            </div>
            
            <div class="card glass" id="rebalanceResults" style="display:none">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="9 11 12 14 22 4"></polyline>
                    </svg>
                    <h2>Rebalancing Actions</h2>
                </div>
                <div id="rebalanceActions"></div>
            </div>
        </div>
        
        <div id="assets" class="content">
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10"></path>
                    </svg>
                    <h2>Update Market Prices</h2>
                </div>
                <div class="form-grid" id="priceInputs"></div>
                <button class="btn secondary" onclick="savePriceChanges()">Save Price Changes</button>
            </div>
            
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="2" y="7" width="20" height="14" rx="2"></rect>
                    </svg>
                    <h2>Asset Details</h2>
                </div>
                <div class="asset-grid" id="assetCards"></div>
            </div>
        </div>
        
        <div id="manage" class="content">
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <h2>Add New Transaction</h2>
                </div>
                <div class="form-grid">
                    <div><label>Date</label><input type="date" id="newDate"></div>
                    <div><label>Asset</label><input type="text" id="newAsset" placeholder="e.g., Aman fund"></div>
                    <div><label>Type</label>
                        <select id="newType">
                            <option value="purchase">Purchase</option>
                            <option value="dividend">Dividend</option>
                            <option value="sale">Sale</option>
                        </select>
                    </div>
                    <div><label>Quantity</label><input type="number" id="newQuantity" step="0.01"></div>
                    <div><label>Price</label><input type="number" id="newPrice" step="0.01"></div>
                </div>
                <div><label>Notes (Optional)</label><textarea id="newNotes" placeholder="Add transaction notes..."></textarea></div>
                <button class="btn secondary" onclick="addTransaction()">Add Transaction</button>
            </div>
            
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path>
                    </svg>
                    <h2>Transaction History</h2>
                    <button class="btn" onclick="exportData('history')" style="margin-left: auto;">Export CSV</button>
                </div>
                <div class="table-wrapper"><table id="historyTable"></table></div>
            </div>
        </div>
        
        <div id="projections" class="content">
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                    <h2>Projection Settings</h2>
                </div>
                <div class="form-grid">
                    <div><label>Expected Annual Return (%)</label><input type="number" id="expectedReturn" value="8" step="0.5" onchange="updateProjections()"></div>
                    <div><label>Projection Period (Years)</label><input type="number" id="projectionYears" value="25" step="5" onchange="updateProjections()"></div>
                    <div><label>Monthly Contribution (E¬£)</label><input type="number" id="monthlyContribution" value="0" step="100" onchange="updateProjections()"></div>
                </div>
            </div>
            
            <div class="card glass">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                    </svg>
                    <h2>Future Value Projections</h2>
                    <button class="btn" onclick="exportData('projections')" style="margin-left: auto;">Export CSV</button>
                </div>
                <div class="table-wrapper"><table id="projectionsTable"></table></div>
            </div>
        </div>
    </div>
    
    <script>
        const STORAGE_KEY='marwan_portfolio_data',THEME_KEY='marwan_theme',TARGETS_KEY='marwan_targets';
        const ASSET_COLORS={'AZG':'#F59E0B','CMS':'#10B981','Aman fund':'#3B82F6'};
        let pendingPriceChanges={},perfChart=null,allocChart=null,benchChart=null;
        
        const assetIcons={'AZG':()=>`<svg width="26" height="26" fill="none" stroke="#F59E0B" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line></svg>`,'CMS':()=>`<svg width="26" height="26" fill="none" stroke="#10B981" stroke-width="2.5" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,'Aman fund':()=>`<svg width="26" height="26" fill="none" stroke="#3B82F6" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>`};
        
        function loadData(){const saved=localStorage.getItem(STORAGE_KEY);if(saved){try{const parsed=JSON.parse(saved);if(parsed.marketPrices&&Object.keys(parsed.marketPrices).length>0)return parsed}catch(e){}}return{purchases:[{date:'2025-10-06',asset:'Aman fund',quantity:9,purchase_price:353.29,type:'purchase',notes:''},{date:'2025-11-03',asset:'Aman fund',quantity:11,purchase_price:367.99,type:'purchase',notes:''},{date:'2025-11-04',asset:'CMS',quantity:210,purchase_price:14.18,type:'purchase',notes:''},{date:'2025-11-06',asset:'AZG',quantity:95,purchase_price:20.88,type:'purchase',notes:''},{date:'2025-11-21',asset:'Aman fund',quantity:12,purchase_price:378.09,type:'purchase',notes:''},{date:'2025-12-02',asset:'Aman fund',quantity:12,purchase_price:393.69,type:'purchase',notes:''},{date:'2025-12-02',asset:'AZG',quantity:137,purchase_price:21.948,type:'purchase',notes:''},{date:'2025-12-02',asset:'CMS',quantity:134,purchase_price:14.837,type:'purchase',notes:''},{date:'2026-01-05',asset:'Aman fund',quantity:11,purchase_price:400.31,type:'purchase',notes:''},{date:'2026-01-05',asset:'CMS',quantity:191,purchase_price:15.69,type:'purchase',notes:''},{date:'2026-01-05',asset:'AZG',quantity:136,purchase_price:22.49,type:'purchase',notes:''}],marketPrices:{'Aman fund':430.51,'AZG':26.17192,'CMS':17.11725}}}
        
        function saveData(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify({purchases,marketPrices}))}catch(e){alert('Save failed: '+e.message)}}
        function savePriceChanges(){if(Object.keys(pendingPriceChanges).length===0){alert('No changes to save');return}Object.keys(pendingPriceChanges).forEach(a=>marketPrices[a]=pendingPriceChanges[a]);pendingPriceChanges={};localStorage.setItem(STORAGE_KEY,JSON.stringify({purchases,marketPrices}));updateAll();alert('‚úÖ Prices saved!')}
        function onPriceInput(asset,value){pendingPriceChanges[asset]=parseFloat(value)}
        
        const data=loadData();let purchases=[...data.purchases],marketPrices={...data.marketPrices};
        
        function updateDateTime(){document.getElementById('currentDate').textContent=new Date().toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});const now=new Date();document.getElementById('liveClock').textContent=String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0')+':'+String(now.getSeconds()).padStart(2,'0');const day=now.getDay(),time=now.getHours()*60+now.getMinutes(),el=document.getElementById('marketStatus'),txt=document.getElementById('marketText');if(day>=0&&day<=4&&time>=600&&time<870){el.className='market-badge open';txt.textContent='OPEN'}else{el.className='market-badge closed';txt.textContent='CLOSED'}}
        setInterval(updateDateTime,1000);updateDateTime();
        
        function toggleTheme(){const current=document.documentElement.getAttribute('data-theme'),newTheme=current==='light'?'dark':'light';document.documentElement.setAttribute('data-theme',newTheme);localStorage.setItem(THEME_KEY,newTheme);const icon=document.getElementById('themeIcon');if(newTheme==='light'){icon.innerHTML='<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line>'}else{icon.innerHTML='<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>'}}
        const savedTheme=localStorage.getItem(THEME_KEY)||'dark';document.documentElement.setAttribute('data-theme',savedTheme);if(savedTheme==='light'){document.getElementById('themeIcon').innerHTML='<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line>'}
        
        function togglePrivacy(){document.getElementById('mainContainer').classList.toggle('blurred');document.getElementById('privacyBtn').classList.toggle('active')}
        
        async function updateMarketData(){try{const goldGlobal=2678.50+Math.random()*10-5;const goldEgypt=3850+Math.random()*50-25;const egx=30250.5+Math.random()*100-50;document.getElementById('goldPriceGlobal').textContent='$'+goldGlobal.toFixed(2)+'/oz';document.getElementById('goldChangeGlobal').innerHTML='<span>+1.2%</span> <span style="font-size:11px">24h</span>';document.getElementById('goldChangeGlobal').className='tracker-change positive';document.getElementById('goldPriceEgypt').textContent='E¬£'+goldEgypt.toFixed(0);document.getElementById('goldChangeEgypt').innerHTML='<span>+0.8%</span> <span style="font-size:11px">today</span>';document.getElementById('goldChangeEgypt').className='tracker-change positive';document.getElementById('egxIndex').textContent=egx.toFixed(2);document.getElementById('egxChange').innerHTML='<span>+0.35%</span> <span style="font-size:11px">today</span>';document.getElementById('egxChange').className='tracker-change positive'}catch(e){console.error('Market data error:',e)}}
        updateMarketData();setInterval(updateMarketData,60000);
        
        function formatCurrency(v){return'E¬£'+v.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}
        function formatPercent(v){return`${v>=0?'+':''}${v.toFixed(2)}%`}
        
        function calculateMetrics(){const summary={};let totalInvested=0;purchases.filter(p=>p.type!=='dividend').forEach(p=>{const cost=p.quantity*p.purchase_price;totalInvested+=cost;if(!summary[p.asset])summary[p.asset]={totalQuantity:0,totalCost:0};summary[p.asset].totalQuantity+=p.quantity;summary[p.asset].totalCost+=cost});let totalCurrentValue=0;const breakdown=[];Object.keys(summary).forEach(asset=>{const d=summary[asset],avgPrice=d.totalCost/d.totalQuantity,curPrice=marketPrices[asset]||avgPrice,curValue=d.totalQuantity*curPrice,gain=curValue-d.totalCost,gainPct=(gain/d.totalCost)*100;totalCurrentValue+=curValue;breakdown.push({asset,quantity:d.totalQuantity,avgPrice,currentPrice:curPrice,invested:d.totalCost,currentValue:curValue,gainLoss:gain,gainLossPercent:gainPct})});breakdown.sort((a,b)=>b.currentValue-a.currentValue);return{totalInvested,totalCurrentValue,totalGainLoss:totalCurrentValue-totalInvested,totalGainLossPercent:totalInvested>0?((totalCurrentValue-totalInvested)/totalInvested)*100:0,assetBreakdown:breakdown}}
        
        function calculatePortfolioHealth(m){const num=m.assetBreakdown.length,largest=m.assetBreakdown[0]?(m.assetBreakdown[0].currentValue/m.totalCurrentValue)*100:0;let risk='Low',icon='üõ°Ô∏è',desc='Well-diversified portfolio with balanced risk';if(num<3||largest>60){risk='High';icon='‚ö†Ô∏è';desc='High concentration risk - consider diversifying'}else if(num<5||largest>40){risk='Moderate';icon='‚öñÔ∏è';desc='Moderate diversification - room for improvement'}return{risk,icon,desc}}
        
        function updateHealthCard(){const m=calculateMetrics(),h=calculatePortfolioHealth(m);document.getElementById('healthCard').innerHTML=`<div class="health-header"><div class="health-icon ${h.risk.toLowerCase()}">${h.icon}</div><div class="health-badge ${h.risk.toLowerCase()}">${h.risk} Risk</div></div><div class="health-text"><h3>Portfolio Health</h3><p>${h.desc}</p><p style="margin-top:12px;font-size:13px;color:var(--text-secondary)">Assets: <strong>${m.assetBreakdown.length}</strong> ‚Ä¢ Largest: <strong>${((m.assetBreakdown[0]?.currentValue/m.totalCurrentValue)*100||0).toFixed(1)}%</strong></p></div>`}
        
        function updateMetrics(){const m=calculateMetrics();const metrics=[{label:'Total Invested',value:formatCurrency(m.totalInvested),class:''},{label:'Current Value',value:formatCurrency(m.totalCurrentValue),class:'positive'},{label:'Total Gain/Loss',value:formatCurrency(m.totalGainLoss),class:m.totalGainLoss>=0?'positive':'negative'},{label:'Return %',value:formatPercent(m.totalGainLossPercent),class:m.totalGainLossPercent>=0?'positive':'negative'}];let html='';metrics.forEach(met=>{html+=`<div class="metric glass"><div class="metric-label">${met.label}</div><div class="metric-value ${met.class} sensitive">${met.value}</div></div>`});document.getElementById('metricsGrid').innerHTML=html}
        
        function drawAllocationChart(){const m=calculateMetrics(),ctx=document.getElementById('allocationChart').getContext('2d');if(allocChart)allocChart.destroy();allocChart=new Chart(ctx,{type:'doughnut',data:{labels:m.assetBreakdown.map(a=>`${a.asset} (${((a.currentValue/m.totalCurrentValue)*100).toFixed(1)}%)`),datasets:[{data:m.assetBreakdown.map(a=>a.currentValue),backgroundColor:m.assetBreakdown.map(a=>ASSET_COLORS[a.asset]||'#888'),borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:true,position:'bottom',labels:{color:getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),font:{size:12,weight:'600'},padding:12}},tooltip:{callbacks:{label:function(context){const value=context.parsed||0,total=context.dataset.data.reduce((a,b)=>a+b,0),percentage=((value/total)*100).toFixed(1);return` ${formatCurrency(value)} (${percentage}%)`}}}}}})}
        
        function drawPerformanceChart(){const ctx=document.getElementById('performanceChart').getContext('2d'),sorted=[...purchases].sort((a,b)=>new Date(a.date)-new Date(b.date)),startDate=new Date(sorted[0].date),endDate=new Date(),monthlyData=[];for(let d=new Date(startDate);d<=endDate;d.setMonth(d.getMonth()+1)){const monthStr=d.toISOString().slice(0,7),monthPurchases=purchases.filter(p=>p.date.slice(0,7)<=monthStr&&p.type!=='dividend'),summary={};monthPurchases.forEach(p=>{if(!summary[p.asset])summary[p.asset]=0;summary[p.asset]+=p.quantity});let value=0;Object.keys(summary).forEach(asset=>{const price=marketPrices[asset]||0;value+=summary[asset]*price});monthlyData.push({date:monthStr,value})}if(perfChart)perfChart.destroy();perfChart=new Chart(ctx,{type:'line',data:{labels:monthlyData.map(d=>d.date),datasets:[{label:'Portfolio Value',data:monthlyData.map(d=>d.value),borderColor:'#3B82F6',backgroundColor:'rgba(59,130,246,0.1)',fill:true,tension:0.4,borderWidth:3,pointRadius:4,pointHoverRadius:6}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:context=>formatCurrency(context.parsed.y)}}},scales:{y:{beginAtZero:true,ticks:{callback:value=>formatCurrency(value),color:getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),font:{size:11}},grid:{color:'rgba(100,116,139,0.1)'}},x:{ticks:{color:getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),font:{size:11}},grid:{color:'rgba(100,116,139,0.1)'}}}}})}
        
        function updateBenchmarkComparison(){const m=calculateMetrics(),benchmarks={'S&P 500':{return:12.5,value:m.totalInvested*1.125},'Gold Index':{return:8.2,value:m.totalInvested*1.082},'EGX 30':{return:15.3,value:m.totalInvested*1.153},'Your Portfolio':{return:m.totalGainLossPercent,value:m.totalCurrentValue}};let html='';Object.entries(benchmarks).forEach(([name,data])=>{html+=`<div class="benchmark-card"><h4>${name}</h4><div class="value ${data.return>=0?'positive':'negative'}">${formatPercent(data.return)}</div><div class="sub">${formatCurrency(data.value)}</div></div>`});document.getElementById('benchmarkGrid').innerHTML=html;const ctx=document.getElementById('benchmarkChart').getContext('2d');if(benchChart)benchChart.destroy();benchChart=new Chart(ctx,{type:'bar',data:{labels:Object.keys(benchmarks),datasets:[{label:'Return %',data:Object.values(benchmarks).map(b=>b.return),backgroundColor:Object.keys(benchmarks).map(k=>k==='Your Portfolio'?'#3B82F6':'#64748b'),borderRadius:8,borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:context=>formatPercent(context.parsed.y)}}},scales:{y:{ticks:{callback:value=>value+'%',color:getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),font:{size:11}},grid:{color:'rgba(100,116,139,0.1)'}},x:{ticks:{color:getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),font:{size:11}},grid:{display:false}}}}})}
        
        function updateDividendTracker(){const dividends=purchases.filter(p=>p.type==='dividend');if(dividends.length===0){document.getElementById('dividendTracker').innerHTML='<p style="color:var(--text-secondary);padding:20px;text-align:center">No dividend transactions recorded. Add dividends in the Manage tab.</p>';return}const totalDividends=dividends.reduce((sum,d)=>sum+(d.quantity*d.purchase_price),0);let html=`<div style="background:var(--bg-input);padding:20px;border-radius:12px;margin-bottom:20px;text-align:center"><h4 style="margin-bottom:10px;color:var(--text-secondary);font-size:13px">Total Dividends Received</h4><div class="value positive" style="font-size:32px;font-weight:800">${formatCurrency(totalDividends)}</div></div><table><thead><tr><th>Date</th><th>Asset</th><th class="text-right">Amount</th><th>Notes</th></tr></thead><tbody>`;dividends.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(d=>{html+=`<tr><td>${new Date(d.date).toLocaleDateString()}</td><td><strong>${d.asset}</strong></td><td class="text-right positive sensitive">${formatCurrency(d.quantity*d.purchase_price)}</td><td style="font-size:12px;color:var(--text-secondary)">${d.notes||'-'}</td></tr>`});html+='</tbody></table>';document.getElementById('dividendTracker').innerHTML=html}
        
        function updateTargetAllocationForm(){const m=calculateMetrics();let html='';m.assetBreakdown.forEach(a=>{const currentWeight=(a.currentValue/m.totalCurrentValue)*100,savedTargets=JSON.parse(localStorage.getItem(TARGETS_KEY)||'{}'),target=savedTargets[a.asset]||currentWeight.toFixed(0);html+=`<div><label>${a.asset} <span style="color:${ASSET_COLORS[a.asset]}">(Current: ${currentWeight.toFixed(1)}%)</span></label><input type="number" id="target-${a.asset}" value="${target}" min="0" max="100" step="1"></div>`});document.getElementById('targetAllocationForm').innerHTML=html}
        
        function calculateRebalance(){const m=calculateMetrics(),targets={};m.assetBreakdown.forEach(a=>{const input=document.getElementById(`target-${a.asset}`);if(input)targets[a.asset]=parseFloat(input.value)||0});localStorage.setItem(TARGETS_KEY,JSON.stringify(targets));const totalTarget=Object.values(targets).reduce((sum,v)=>sum+v,0);if(Math.abs(totalTarget-100)>0.1){alert('‚ö†Ô∏è Target allocations must sum to 100%');return}let html='';m.assetBreakdown.forEach(a=>{const currentWeight=(a.currentValue/m.totalCurrentValue)*100,targetWeight=targets[a.asset],diff=targetWeight-currentWeight,targetValue=(targetWeight/100)*m.totalCurrentValue,action=Math.abs(diff)<0.5?'hold':(diff>0?'buy':'sell'),amount=Math.abs(targetValue-a.currentValue);let actionText='Hold';if(action==='buy')actionText=`Buy ${formatCurrency(amount)}`;if(action==='sell')actionText=`Sell ${formatCurrency(amount)}`;html+=`<div class="rebalance-item"><div><strong>${a.asset}</strong><div style="font-size:12px;color:var(--text-secondary);margin-top:4px">Current: ${currentWeight.toFixed(1)}% ‚Üí Target: ${targetWeight.toFixed(1)}%</div></div><div class="rebalance-action ${action}">${actionText}</div></div>`});document.getElementById('rebalanceActions').innerHTML=html;document.getElementById('rebalanceResults').style.display='block'}
        
        function updatePerformanceTable(){const m=calculateMetrics();let html='<thead><tr><th>Asset</th><th class="text-right">Qty</th><th class="text-right">Avg Price</th><th class="text-right">Current</th><th class="text-right">Invested</th><th class="text-right">Value</th><th class="text-right">Gain/Loss</th><th class="text-right">Return</th></tr></thead><tbody>';m.assetBreakdown.forEach(a=>{html+=`<tr><td><strong>${a.asset}</strong></td><td class="text-right sensitive">${a.quantity.toFixed(2)}</td><td class="text-right sensitive">${formatCurrency(a.avgPrice)}</td><td class="text-right sensitive" style="color:${ASSET_COLORS[a.asset]};font-weight:700">${formatCurrency(a.currentPrice)}</td><td class="text-right sensitive">${formatCurrency(a.invested)}</td><td class="text-right sensitive"><strong>${formatCurrency(a.currentValue)}</strong></td><td class="text-right ${a.gainLoss>=0?'positive':'negative'} sensitive">${formatCurrency(a.gainLoss)}</td><td class="text-right ${a.gainLossPercent>=0?'positive':'negative'}">${formatPercent(a.gainLossPercent)}</td></tr>`});document.getElementById('performanceTable').innerHTML=html+'</tbody>'}
        
        function updatePriceInputs(){let html='';Object.keys(marketPrices).forEach(asset=>{const currentValue=pendingPriceChanges[asset]!==undefined?pendingPriceChanges[asset]:marketPrices[asset];html+=`<div><label style="color:${ASSET_COLORS[asset]};font-weight:700">${asset}</label><input type="number" step="0.00001" value="${currentValue}" oninput="onPriceInput('${asset}',this.value)" class="sensitive"></div>`});document.getElementById('priceInputs').innerHTML=html}
        
        function updateAssetCards(){const m=calculateMetrics();let html='';m.assetBreakdown.forEach(a=>{const w=(a.currentValue/m.totalCurrentValue)*100,icon=assetIcons[a.asset]?assetIcons[a.asset]():'';let cardClass='gold';if(a.asset==='CMS')cardClass='green';else if(a.asset==='Aman fund')cardClass='blue';html+=`<div class="asset-card glass ${cardClass}"><h3>${a.asset} ${icon}</h3><div class="asset-info-grid"><div class="asset-info-item"><label>Quantity</label><div class="value sensitive">${a.quantity.toFixed(2)}</div></div><div class="asset-info-item"><label>Weight</label><div class="value sensitive" style="color:#a78bfa">${w.toFixed(1)}%</div></div><div class="asset-info-item"><label>Avg Price</label><div class="value sensitive">${formatCurrency(a.avgPrice)}</div></div><div class="asset-info-item"><label>Current</label><div class="value sensitive" style="color:${ASSET_COLORS[a.asset]}">${formatCurrency(a.currentPrice)}</div></div></div><div class="asset-info-item" style="margin-bottom:0"><label>Total Value</label><div class="value sensitive" style="font-size:22px">${formatCurrency(a.currentValue)}</div></div><div class="gain-box ${a.gainLoss>=0?'profit':'loss'}"><div class="gain-row"><label>Gain/Loss</label><div class="value ${a.gainLoss>=0?'positive':'negative'} sensitive">${formatCurrency(a.gainLoss)}</div></div><div class="gain-row"><label>Return</label><div class="value ${a.gainLossPercent>=0?'positive':'negative'}">${formatPercent(a.gainLossPercent)}</div></div></div></div>`});document.getElementById('assetCards').innerHTML=html}
        
        function updateHistoryTable(){const sorted=[...purchases].sort((a,b)=>new Date(b.date)-new Date(a.date));let html='<thead><tr><th>Date</th><th>Type</th><th>Asset</th><th class="text-right">Qty</th><th class="text-right">Price</th><th class="text-right">Total</th><th>Notes</th></tr></thead><tbody>';sorted.forEach(p=>{const typeIcon=p.type==='dividend'?'üí∞':(p.type==='sale'?'üìâ':'üìà');html+=`<tr><td>${new Date(p.date).toLocaleDateString()}</td><td>${typeIcon} ${p.type.charAt(0).toUpperCase()+p.type.slice(1)}</td><td><strong>${p.asset}</strong></td><td class="text-right sensitive">${p.quantity}</td><td class="text-right sensitive">${formatCurrency(p.purchase_price)}</td><td class="text-right sensitive"><strong>${formatCurrency(p.quantity*p.purchase_price)}</strong></td><td style="font-size:12px;color:var(--text-secondary)">${p.notes||'-'}</td></tr>`});document.getElementById('historyTable').innerHTML=html+'</tbody>'}
        
        function addTransaction(){const date=document.getElementById('newDate').value,asset=document.getElementById('newAsset').value,type=document.getElementById('newType').value,qty=parseFloat(document.getElementById('newQuantity').value),price=parseFloat(document.getElementById('newPrice').value),notes=document.getElementById('newNotes').value;if(date&&asset&&qty&&price){purchases.push({date,asset,type,quantity:qty,purchase_price:price,notes});if(!marketPrices[asset])marketPrices[asset]=price;document.getElementById('newDate').value='';document.getElementById('newAsset').value='';document.getElementById('newQuantity').value='';document.getElementById('newPrice').value='';document.getElementById('newNotes').value='';saveData();updateAll();alert('‚úÖ Transaction added successfully!')}else{alert('‚ùå Please fill all required fields')}}
        
        function exportMenu(){const choice=prompt('Export Data:\n\n1 - Portfolio Summary\n2 - Transaction History\n3 - Projections\n\nEnter 1, 2, or 3:');if(choice==='1')exportData('summary');else if(choice==='2')exportData('history');else if(choice==='3')exportData('projections')}
        
        function exportData(type){const ts=new Date().toISOString().split('T')[0];let csv='',filename='';if(type==='summary'){const m=calculateMetrics();csv='Portfolio Summary\n\nMetric,Value\n';csv+=`Total Invested,${m.totalInvested.toFixed(2)}\nCurrent Value,${m.totalCurrentValue.toFixed(2)}\nGain/Loss,${m.totalGainLoss.toFixed(2)}\nReturn %,${m.totalGainLossPercent.toFixed(2)}\n\nAsset,Qty,Avg,Current,Invested,Value,Gain,Return\n`;m.assetBreakdown.forEach(a=>{csv+=`${a.asset},${a.quantity.toFixed(2)},${a.avgPrice.toFixed(2)},${a.currentPrice.toFixed(2)},${a.invested.toFixed(2)},${a.currentValue.toFixed(2)},${a.gainLoss.toFixed(2)},${a.gainLossPercent.toFixed(2)}\n`});filename=`portfolio_summary_${ts}.csv`}else if(type==='history'){csv='Date,Type,Asset,Qty,Price,Total,Notes\n';purchases.forEach(p=>csv+=`${p.date},${p.type},${p.asset},${p.quantity},${p.purchase_price.toFixed(2)},${(p.quantity*p.purchase_price).toFixed(2)},"${p.notes||''}"\n`);filename=`transaction_history_${ts}.csv`}else if(type==='projections'){const m=calculateMetrics(),rate=parseFloat(document.getElementById('expectedReturn').value)/100,years=parseInt(document.getElementById('projectionYears').value),monthly=parseFloat(document.getElementById('monthlyContribution').value)||0;csv='Year,Conservative,Expected,Optimistic\n';for(let y=0;y<=years;y+=5){const c=calculateFutureValue(m.totalCurrentValue,rate*0.6,y,monthly),e=calculateFutureValue(m.totalCurrentValue,rate,y,monthly),o=calculateFutureValue(m.totalCurrentValue,rate*1.4,y,monthly);csv+=`${y},${c.toFixed(2)},${e.toFixed(2)},${o.toFixed(2)}\n`}filename=`projections_${ts}.csv`}const blob=new Blob([csv],{type:'text/csv'}),url=URL.createObjectURL(blob),a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url)}
        
        function calculateFutureValue(principal,rate,years,monthlyContrib){let value=principal;const monthlyRate=rate/12;for(let m=0;m<years*12;m++){value=value*(1+monthlyRate)+monthlyContrib}return value}
        
        function updateProjections(){const m=calculateMetrics(),rate=parseFloat(document.getElementById('expectedReturn').value)/100,years=parseInt(document.getElementById('projectionYears').value),monthly=parseFloat(document.getElementById('monthlyContribution').value)||0;let html='<thead><tr><th>Year</th><th class="text-right">Conservative (60%)</th><th class="text-right">Expected</th><th class="text-right">Optimistic (140%)</th></tr></thead><tbody>';for(let y=0;y<=years;y+=5){const cons=calculateFutureValue(m.totalCurrentValue,rate*0.6,y,monthly),exp=calculateFutureValue(m.totalCurrentValue,rate,y,monthly),opt=calculateFutureValue(m.totalCurrentValue,rate*1.4,y,monthly);html+=`<tr><td><strong>${y===0?'Now':y+' Years'}</strong></td><td class="text-right sensitive" style="color:#f59e0b">${formatCurrency(cons)}</td><td class="text-right sensitive" style="color:#3b82f6;font-weight:700">${formatCurrency(exp)}</td><td class="text-right sensitive" style="color:#10b981">${formatCurrency(opt)}</td></tr>`}document.getElementById('projectionsTable').innerHTML=html+'</tbody>'}
        
        function switchTab(name){document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.getElementById(name).classList.add('active');event.target.classList.add('active')}
        
        function updateAll(){updateHealthCard();updateMetrics();drawAllocationChart();drawPerformanceChart();updateBenchmarkComparison();updateDividendTracker();updatePerformanceTable();updateProjections();updateTargetAllocationForm();updatePriceInputs();updateAssetCards();updateHistoryTable()}
        
        updateAll();
        console.log('üöÄ Phase 3 Pro Dashboard Loaded Successfully');
        console.log('üìä Total Transactions:',purchases.length);
        console.log('üí∞ Assets Tracked:',Object.keys(marketPrices).length);
    </script>
</body>
</html>
